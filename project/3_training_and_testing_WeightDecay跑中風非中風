{"cells":[{"cell_type":"markdown","metadata":{"id":"YCjLyz1z3dB3"},"source":["# Training and Testing\n","\n","Action items\n","- Dataset\n","- Model\n","- DataLoader\n","- Training\n","- Testing"]},{"cell_type":"markdown","metadata":{"id":"TXVRx2KI5TXh"},"source":["## Dataset"]},{"cell_type":"code","execution_count":1,"metadata":{"executionInfo":{"elapsed":1948,"status":"ok","timestamp":1659535069470,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"BmzBt1ou5SP0"},"outputs":[],"source":["import glob\n","import os\n","\n","import numpy as np\n","from PIL import Image\n","import torch\n","import torch.nn as nn\n","import torch.optim as optim\n","import torchvision\n","from torchvision.models import resnet18, resnet50, resnet101, resnet152\n","from torch.utils.data import Dataset, DataLoader\n","import matplotlib.pyplot as plt\n","from tqdm.notebook import tqdm, trange\n","from sklearn.metrics import confusion_matrix\n","import random\n","\n","# Seed\n","seed = 2022\n","torch.manual_seed(seed)\n","torch.cuda.manual_seed(seed)\n","torch.cuda.manual_seed_all(seed)\n","np.random.seed(seed)\n","random.seed(seed)\n","torch.backends.cudnn.benchmark = False\n","torch.backends.cudnn.deterministic = True"]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3960,"status":"ok","timestamp":1659535073425,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"DJ0FI4CMYroX","outputId":"f489596e-0b0a-4b74-f24e-303dd54e7813"},"outputs":[{"name":"stdout","output_type":"stream","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive', force_remount=True)\n","\n","FOLDERNAME = 'Colab\\ Notebooks/3_Split'"]},{"cell_type":"code","execution_count":3,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":6,"status":"ok","timestamp":1659535073425,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"BctYFtp5ZmhU","outputId":"48649ba8-f036-45f7-feb0-59aa45f6f8e0"},"outputs":[{"name":"stdout","output_type":"stream","text":["/content/drive/MyDrive/Colab Notebooks/3_Split\n"]}],"source":["%cd drive/MyDrive/$FOLDERNAME"]},{"cell_type":"code","execution_count":4,"metadata":{"executionInfo":{"elapsed":3,"status":"ok","timestamp":1659535073425,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"P39uJuXoZvvK"},"outputs":[],"source":["# %ls"]},{"cell_type":"code","execution_count":5,"metadata":{"executionInfo":{"elapsed":4,"status":"ok","timestamp":1659535073426,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"5Mgsaj5g7wll"},"outputs":[],"source":["label_dict = {\n","    \"Non-stroke\": 0,\n","    \"ICH\": 1,\n","    \"Ischemic\": 1,\n","}"]},{"cell_type":"code","execution_count":6,"metadata":{"executionInfo":{"elapsed":4,"status":"ok","timestamp":1659535073426,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"nV0MiaOg5Fro"},"outputs":[],"source":["class ECGDataset(Dataset):\n","\n","    def __init__(self, data_path, label_dict):\n","        self.files = sorted(glob.glob(os.path.join(data_path, \"*.jpg\")))\n","        self.n = len(self.files)\n","        self.label_dict = label_dict\n","\n","    def __len__(self):\n","        return self.n\n","\n","    def __getitem__(self, idx):\n","        img = Image.open(self.files[idx])\n","        x = 1.0 - torchvision.transforms.ToTensor()(img)\n","        # x = x.squeeze()\n","        # x = x.T\n","        # x = x.unsqueeze(0)\n","        with open(self.files[idx].replace(\".jpg\", \".txt\")) as f:\n","            label = f.read()\n","        y = self.label_dict[label]\n","        return x, y"]},{"cell_type":"code","execution_count":7,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":471,"status":"ok","timestamp":1659535073893,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"WLq6A0k16hGH","outputId":"c39ba32b-cb81-4202-81d9-c3b317bc6515"},"outputs":[{"name":"stdout","output_type":"stream","text":["ds_train 3351\n"]}],"source":["ds_train = ECGDataset(\"Train_oversample\", label_dict)\n","print(\"ds_train\", len(ds_train))"]},{"cell_type":"code","execution_count":8,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4,"status":"ok","timestamp":1659535073893,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"ANaI1bdNYu9_","outputId":"139eefb0-22b1-4576-8674-6e397e12bfee"},"outputs":[{"name":"stdout","output_type":"stream","text":["ds_val 243\n"]}],"source":["ds_val = ECGDataset(\"Val\", label_dict)\n","print(\"ds_val\", len(ds_val))"]},{"cell_type":"code","execution_count":9,"metadata":{"executionInfo":{"elapsed":2,"status":"ok","timestamp":1659535073893,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"DhbbTPNp6pBa"},"outputs":[],"source":["\n","\n","# fig = plt.figure(figsize=(20, 15))\n","# for i in range(16):\n","#     x, y = ds_train[i]\n","#     plt.subplot(4, 4, i + 1)\n","#     plt.imshow(x[0, :, :])\n","#     plt.text(100, 100, y, fontsize=20, color=\"w\")\n","#     # plt.colorbar()\n","#     plt.axis(\"off\")"]},{"cell_type":"markdown","metadata":{"id":"UAUlVFPU8RYr"},"source":["## Model"]},{"cell_type":"code","execution_count":10,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":776,"status":"ok","timestamp":1659535074667,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"XPXdB5_C6sz-","outputId":"92f1f325-71e9-4839-950d-c9b6f5a8d04d"},"outputs":[{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.7/dist-packages/torchvision/models/_utils.py:209: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and will be removed in 0.15, please use 'weights' instead.\n","  f\"The parameter '{pretrained_param}' is deprecated since 0.13 and will be removed in 0.15, \"\n","/usr/local/lib/python3.7/dist-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and will be removed in 0.15. The current behavior is equivalent to passing `weights=None`.\n","  warnings.warn(msg)\n"]}],"source":["model = resnet50(pretrained=False)\n","model.conv1 = nn.Conv2d(1, 64, kernel_size=(7, 7), stride=(2, 2), padding=(3, 3), bias=False)\n","model.fc = nn.Linear(in_features=model.fc.in_features, out_features=2, bias=True)"]},{"cell_type":"code","execution_count":11,"metadata":{"executionInfo":{"elapsed":2,"status":"ok","timestamp":1659535074667,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"-H1kryBF6AV7"},"outputs":[],"source":["# class RNN(nn.Module):\n","#   def __init__(self, input_size, hidden_size, output_size):\n","#     super().__init__()\n","#     self.lstm = nn.LSTM(input_size, hidden_size, batch_first = True)\n","#     self.fc = nn.Linear(hidden_size, output_size)\n","#   def forward(self, x):\n","#     # N x 1 x 1024 x 640\n","#     x = x.squeeze(1)\n","#     # N x 1024 x 640\n","#     output, _ = self.lstm(x)\n","#     out = output[:,-1, :]\n","#     return self.fc(out)"]},{"cell_type":"code","execution_count":12,"metadata":{"executionInfo":{"elapsed":3,"status":"ok","timestamp":1659535074668,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"Gp1WxRSDwZVZ"},"outputs":[],"source":["# class MyModel(nn.Module):\n","#   def __init__(self, input_size, hidden_size, output_size):\n","#     super().__init__()\n","#     self.conv2d1 = nn.Conv2d(1, 64, 3, 1, 1)\n","#     self.batch_norm2d1 = nn.BatchNorm2d(64)\n","#     self.conv2d2 = nn.Conv2d(64, 1, 3, 1, 1)\n","#     self.batch_norm2d2 = nn.BatchNorm2d(1)\n","#     self.lstm = nn.LSTM(input_size, hidden_size, batch_first = True)\n","#     self.fc = nn.Linear(hidden_size, output_size)\n","#   def forward(self, x):\n","#     # N x 1 x 1024 x 640\n","#     out = self.conv2d1(x)\n","#     # N x 64 x 1024 x 640\n","#     out = self.batch_norm2d1(out)\n","#     out = nn.functional.relu(out)\n","#     # N x 1 x 1024 x 640\n","#     out = self.conv2d2(out)\n","#     out = self.batch_norm2d2(out)\n","#     out = nn.functional.relu(out)\n","#     out = nn.functional.max_pool2d(out, (2,2))\n","#     # N x 1 x 512 x 320\n","#     out = out.squeeze(1)\n","#     # N x 512 x 320\n","#     output, _ = self.lstm(out)\n","#     out = output[:,-1, :]\n","#     return self.fc(out)"]},{"cell_type":"code","execution_count":13,"metadata":{"executionInfo":{"elapsed":2,"status":"ok","timestamp":1659535074668,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"87b7B9gpxsIU"},"outputs":[],"source":["# model = MyModel(320, 64, 3)\n","# model = RNN(640, 256, 3)\n","# model"]},{"cell_type":"code","execution_count":14,"metadata":{"executionInfo":{"elapsed":2,"status":"ok","timestamp":1659535074668,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"8TPyIYIVGG8S"},"outputs":[],"source":["## 如果要load特定model 請改back up之model名\n","# model.load_state_dict(torch.load(\"backup_RNN_0.0005_012000.pth\"))"]},{"cell_type":"code","execution_count":15,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2,"status":"ok","timestamp":1659535074668,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"nNE3p19t9DQW","outputId":"52bbec0e-deaf-427a-f21b-16c517a91756"},"outputs":[{"data":{"text/plain":["torch.Size([1, 1, 640, 1024])"]},"execution_count":15,"metadata":{},"output_type":"execute_result"}],"source":["x, y = ds_train[0]\n","x = x.unsqueeze(0)\n","x.size()"]},{"cell_type":"code","execution_count":16,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4811,"status":"ok","timestamp":1659535079477,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"2ZI2bpWy-o1i","outputId":"e474d710-f7f5-46dd-ab8a-2cd5b7356b1c"},"outputs":[{"name":"stdout","output_type":"stream","text":["outputs tensor([[ 0.3191, -0.5079]], grad_fn=\u003cAddmmBackward0\u003e)\n"]}],"source":["out = model(x)\n","print(\"outputs\", out)"]},{"cell_type":"code","execution_count":17,"metadata":{"executionInfo":{"elapsed":15,"status":"ok","timestamp":1659535079477,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"CsiDj8W1-tfa"},"outputs":[],"source":["# outputs"]},{"cell_type":"code","execution_count":18,"metadata":{"executionInfo":{"elapsed":2581,"status":"ok","timestamp":1659535082044,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"tmzi3wnL-3tA"},"outputs":[],"source":["device = torch.device(\"cuda:0\")\n","model = model.to(device)"]},{"cell_type":"markdown","metadata":{"id":"Pv9bycTV_I0Q"},"source":["## DataLoader"]},{"cell_type":"code","execution_count":19,"metadata":{"executionInfo":{"elapsed":9,"status":"ok","timestamp":1659535082046,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"X8NS2sEnXsLu"},"outputs":[],"source":["def dataloader(dataset, mode='Train'):\n","  if mode == 'Train':\n","    dl_data = DataLoader(\n","    dataset,\n","    batch_size=4,\n","    shuffle=True,\n","    drop_last=True\n","    )\n","    return dl_data\n","  elif mode == 'Val':\n","    dl_data = DataLoader(\n","    dataset,\n","    batch_size=4,\n","    shuffle=False,\n","    drop_last=False,\n","    )\n","    return dl_data\n"]},{"cell_type":"code","execution_count":20,"metadata":{"executionInfo":{"elapsed":8,"status":"ok","timestamp":1659535082047,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"tSIA28toYdkZ"},"outputs":[],"source":["dl_train = dataloader(ds_train, mode = 'Train')\n","dl_val = dataloader(ds_val, mode = 'Val')"]},{"cell_type":"code","execution_count":21,"metadata":{"executionInfo":{"elapsed":8,"status":"ok","timestamp":1659535082047,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"yWmVeFBH_Dvb"},"outputs":[],"source":["# dl_train = DataLoader(\n","#     ds_train,\n","#     batch_size=4,\n","#     shuffle=True,\n","#     drop_last=True\n","# )\n","# iterable = iter(dl_train)\n","# tensor, lable = next(iterable)\n","# tensor.shape\n"]},{"cell_type":"markdown","metadata":{"id":"Iv7R32k1_ki1"},"source":["## Train"]},{"cell_type":"code","execution_count":22,"metadata":{"executionInfo":{"elapsed":8,"status":"ok","timestamp":1659535082047,"user":{"displayName":"Code Stan","userId":"03254598658053359229"},"user_tz":-480},"id":"2IWRLrWCY3BL"},"outputs":[],"source":["# def training(n_epoch, lr, print_every, backup_every, model, optimizer, loss_fn, traing_data, val_data):\n","#   j_train_list = []\n","#   j_val_loss = []\n","\n","#   seen_batch = 0\n","\n","#   model.train()\n","#   for i in range(n_epoch):\n","#       j = 0\n","#       for (x, y) in tqdm(traing_data):\n","#           optimizer.zero_grad()\n","#           x = x.to(device)\n","#           y = y.to(device)\n","#           outputs = model(x)\n","#           loss = loss_fn(outputs, y)\n","#           j += loss\n","#           loss.backward()\n","#           optimizer.step()\n","#           with torch.no_grad():\n","#               seen_batch = seen_batch + 1\n","#               if seen_batch % print_every == 0:\n","#                   print(i, \"epoch: loss\", loss.item())\n","#               if seen_batch % backup_every == 0:\n","#                   torch.save(model.state_dict(), \"backup_RNN_0.0005_{:06d}.pth\".format(seen_batch))\n","#       j /= len(dl_train)\n","#       j_train_list.append(j)\n","#       cost_val = val(model, val_data)\n","#       print(i, \"epoch: cost_val\", loss.item())\n","#   return j_train_list, j_val_loss"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/","height":49},"id":"BmQ7TS_B_j33"},"outputs":[{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"a7dffa3060124c63b685c3799e606317","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["0 epoch: loss 0.21458807587623596\n","0 epoch: loss 0.8106702566146851\n","0 epoch: loss 0.6265860795974731\n","0 epoch: loss 0.3883744478225708\n","0 epoch: loss 0.4822586178779602\n","0 epoch: loss 0.5567566752433777\n","0 epoch: loss 0.3136395812034607\n","0 epoch: loss 0.772563099861145\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"ca80f19b37e64060a5c4696f5fe7ea19","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["1 epoch: loss 0.9938391447067261\n","1 epoch: loss 0.5053236484527588\n","1 epoch: loss 0.6548834443092346\n","1 epoch: loss 0.21982614696025848\n","1 epoch: loss 0.7291233539581299\n","1 epoch: loss 0.35725638270378113\n","1 epoch: loss 0.6697479486465454\n","1 epoch: loss 0.34456485509872437\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"2643e1b6115049fa979d5cfb4356db99","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["2 epoch: loss 0.46898651123046875\n","2 epoch: loss 0.530240535736084\n","2 epoch: loss 0.516431987285614\n","2 epoch: loss 1.1328781843185425\n","2 epoch: loss 0.8155585527420044\n","2 epoch: loss 0.5099509954452515\n","2 epoch: loss 0.24562594294548035\n","2 epoch: loss 0.33328777551651\n","2 epoch: loss 1.3110809326171875\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"8a3b240850b04ecda748463954d5ae23","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["3 epoch: loss 0.25580674409866333\n","3 epoch: loss 0.8033369779586792\n","3 epoch: loss 0.24706915020942688\n","3 epoch: loss 0.19692884385585785\n","3 epoch: loss 0.1962607353925705\n","3 epoch: loss 0.11417604237794876\n","3 epoch: loss 0.3234657049179077\n","3 epoch: loss 0.27623048424720764\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"e3c09b4c67db41f2bdedbce8bb313dfc","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["4 epoch: loss 0.22818611562252045\n","4 epoch: loss 0.2110566347837448\n","4 epoch: loss 0.2893257737159729\n","4 epoch: loss 0.1221952885389328\n","4 epoch: loss 0.100154809653759\n","4 epoch: loss 0.04047277569770813\n","4 epoch: loss 0.04918399825692177\n","4 epoch: loss 0.029240339994430542\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"cd20afa9cfee4ec7b3cbe2e4e69136b4","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["5 epoch: loss 0.16084572672843933\n","5 epoch: loss 0.03371220454573631\n","5 epoch: loss 0.1282503306865692\n","5 epoch: loss 0.01091804914176464\n","5 epoch: loss 0.08189298957586288\n","5 epoch: loss 0.3998250663280487\n","5 epoch: loss 0.09398823976516724\n","5 epoch: loss 0.45724618434906006\n","5 epoch: loss 0.08347071707248688\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"54db75c8c2734c5fa7d1f2c84211826e","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["6 epoch: loss 0.04773562401533127\n","6 epoch: loss 0.02233840525150299\n","6 epoch: loss 0.0012171597918495536\n","6 epoch: loss 0.07815771549940109\n","6 epoch: loss 0.04363643750548363\n","6 epoch: loss 0.020223939791321754\n","6 epoch: loss 0.008815372362732887\n","6 epoch: loss 0.004187801852822304\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"743292acb6ce4f4da9650c2e168c9c1a","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["7 epoch: loss 0.005718064494431019\n","7 epoch: loss 0.0003831399080809206\n","7 epoch: loss 0.0007984886760823429\n","7 epoch: loss 0.012566588819026947\n","7 epoch: loss 0.04651862755417824\n","7 epoch: loss 0.00931849516928196\n","7 epoch: loss 0.1215866357088089\n","7 epoch: loss 0.07431980967521667\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"b1833053fe5442599f443674ee9ce1f7","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["8 epoch: loss 0.004829461686313152\n","8 epoch: loss 0.02524806745350361\n","8 epoch: loss 0.002107143634930253\n","8 epoch: loss 0.07714872062206268\n","8 epoch: loss 0.0001484920794609934\n","8 epoch: loss 0.003315441310405731\n","8 epoch: loss 0.0004142231191508472\n","8 epoch: loss 0.3125309646129608\n","8 epoch: loss 0.075090691447258\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"54b67ef7d0574968be878e1cf8a479c2","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["9 epoch: loss 0.013541791588068008\n","9 epoch: loss 0.03197343647480011\n","9 epoch: loss 0.0013920245692133904\n","9 epoch: loss 0.04075540229678154\n","9 epoch: loss 0.0010415023425593972\n","9 epoch: loss 0.007161491550505161\n","9 epoch: loss 0.014433315023779869\n","9 epoch: loss 0.0002560943248681724\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"0ba32c653d83448798ca743cd6846574","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["10 epoch: loss 0.002024182118475437\n","10 epoch: loss 0.0017676858697086573\n","10 epoch: loss 0.11153342574834824\n","10 epoch: loss 0.016216576099395752\n","10 epoch: loss 0.01153551321476698\n","10 epoch: loss 0.00011454883497208357\n","10 epoch: loss 9.613146539777517e-05\n","10 epoch: loss 0.010409548878669739\n","10 epoch: loss 0.3623126149177551\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"f7586c458380429394eec87e64b962cb","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["11 epoch: loss 0.0004329124931246042\n","11 epoch: loss 0.008702538907527924\n","11 epoch: loss 0.00028729235054925084\n","11 epoch: loss 3.358532194397412e-05\n","11 epoch: loss 5.620466617983766e-05\n","11 epoch: loss 0.00034217091160826385\n","11 epoch: loss 0.00272732088342309\n","11 epoch: loss 0.00031140464125201106\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"c996628ffd484c6392efbaf2debac2b9","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["12 epoch: loss 0.0002499697729945183\n","12 epoch: loss 0.000749744416680187\n","12 epoch: loss 0.0012412683572620153\n","12 epoch: loss 0.15507733821868896\n","12 epoch: loss 0.01355916727334261\n","12 epoch: loss 0.0013641269179061055\n","12 epoch: loss 0.01623356156051159\n","12 epoch: loss 0.013778888620436192\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"96901151b55749c68f39f7ee32988f25","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["13 epoch: loss 2.7536227207747288e-05\n","13 epoch: loss 0.0004842439666390419\n","13 epoch: loss 0.00028681184630841017\n","13 epoch: loss 0.003714430145919323\n","13 epoch: loss 0.0003173774457536638\n","13 epoch: loss 0.006820523180067539\n","13 epoch: loss 0.001084573334082961\n","13 epoch: loss 0.00045067412429489195\n","13 epoch: loss 0.0011429175501689315\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"d2772777a6434517807fd80df74104fd","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["14 epoch: loss 2.7060072170570493e-05\n","14 epoch: loss 0.02202332206070423\n","14 epoch: loss 0.06335050612688065\n","14 epoch: loss 0.0024873330257833004\n","14 epoch: loss 0.2951866388320923\n","14 epoch: loss 0.008476927876472473\n","14 epoch: loss 0.0001015566085698083\n","14 epoch: loss 0.0022693644277751446\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"43cd7eb6a8f047ac8c60a11b25f3b69d","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["15 epoch: loss 0.009883231483399868\n","15 epoch: loss 6.898538413224742e-05\n","15 epoch: loss 0.0019061235943809152\n","15 epoch: loss 0.008311682380735874\n","15 epoch: loss 0.004106556531041861\n","15 epoch: loss 0.04177723824977875\n","15 epoch: loss 0.0003968641976825893\n","15 epoch: loss 0.0008274228894151747\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"0f900711d5a94858a2115be8c2c42ef1","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["16 epoch: loss 0.6304985880851746\n","16 epoch: loss 8.55843027238734e-05\n","16 epoch: loss 0.00847879983484745\n","16 epoch: loss 0.007149446755647659\n","16 epoch: loss 0.005882328376173973\n","16 epoch: loss 0.0010876217857003212\n","16 epoch: loss 0.000673451111651957\n","16 epoch: loss 0.0018633329309523106\n","16 epoch: loss 0.0002893660857807845\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"23e4896eaf8d481a9a0fd78648cdc62b","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["17 epoch: loss 0.001086209318600595\n","17 epoch: loss 0.00027349876472726464\n","17 epoch: loss 9.747331205289811e-05\n","17 epoch: loss 0.002588219242170453\n","17 epoch: loss 0.009631423279643059\n","17 epoch: loss 0.007512446027249098\n","17 epoch: loss 0.0006140006007626653\n","17 epoch: loss 0.0009957639267668128\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"154990d0543c409797854479036b1cdd","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["18 epoch: loss 0.011645693331956863\n","18 epoch: loss 0.15654239058494568\n","18 epoch: loss 0.004184539895504713\n","18 epoch: loss 0.16371071338653564\n","18 epoch: loss 0.2483828067779541\n","18 epoch: loss 0.019959524273872375\n","18 epoch: loss 0.001214203191921115\n","18 epoch: loss 1.4513329915644135e-05\n","18 epoch: loss 0.0002670125977601856\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"51d78159cff34bb18a170bedf3cf1bcc","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/837 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["19 epoch: loss 0.0008667830261401832\n","19 epoch: loss 0.2054632604122162\n","19 epoch: loss 0.0008905016584321856\n","19 epoch: loss 0.0006613790756091475\n","19 epoch: loss 0.47944334149360657\n","19 epoch: loss 0.05965695157647133\n","19 epoch: loss 0.06086248904466629\n","19 epoch: loss 0.0006575003499165177\n"]}],"source":["n_epoch = 20\n","lr = 0.0001\n","print_every = 100\n","backup_every = 2000\n","model_name = 'backup_resnet50_20_1e-4_wd1E-7_中風非中風'\n","j_list = []\n","\n","optimizer = optim.Adam(model.parameters(), lr=lr, weight_decay=1e-7)\n","# optimizer = optim.Adam(model.parameters(), lr=lr)\n","loss_fn = nn.CrossEntropyLoss()\n","\n","seen_batch = 0\n","\n","model.train()\n","for i in range(n_epoch):\n","    j = 0\n","    for (x, y) in tqdm(dl_train):\n","        optimizer.zero_grad()\n","        x = x.to(device)\n","        y = y.to(device)\n","        outputs = model(x)\n","        loss = loss_fn(outputs, y)\n","        j += loss\n","        loss.backward()\n","        optimizer.step()\n","        with torch.no_grad():\n","            seen_batch = seen_batch + 1\n","            if seen_batch % print_every == 0:\n","                print(i, \"epoch: loss\", loss.item())\n","            if seen_batch % backup_every == 0:\n","                torch.save(model.state_dict(), \"{}_{:06d}.pth\".format(model_name, seen_batch))\n","    j /= len(dl_train)\n","    j_list.append(j)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"m0w6ogJ8Wbfw"},"outputs":[{"data":{"image/png":"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\n","text/plain":["\u003cFigure size 432x288 with 1 Axes\u003e"]},"metadata":{},"output_type":"display_data"}],"source":["# plot the cost history\n","from matplotlib.ticker import MaxNLocator\n","plt.plot([j_list[i].item() for i in range(len(j_list))])\n","plt.gca().xaxis.set_major_locator(MaxNLocator(integer=True))\n","plt.gca().yaxis.set_major_locator(MaxNLocator(integer=True))\n","\n","plt.xlabel('iteration')\n","plt.ylabel('training cost')\n","plt.title('Training Cost history')\n","plt.show()"]},{"cell_type":"markdown","metadata":{"id":"lvs7Q7UgCM_o"},"source":["## Validation"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"Qpln2j9HBQ-4"},"outputs":[{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"e74fb5a0312a403d8f07eadcc1bd37f2","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/61 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"}],"source":["model.eval()\n","\n","predictions = []\n","\n","with torch.no_grad():\n","    for (x, y) in tqdm(dl_val):\n","        x = x.to(device)\n","        y = y.to(device)\n","        outputs = model(x)\n","        predictions.append(outputs)\n","        "]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"_CcCiP5fC5Tr"},"outputs":[],"source":["predictions = np.concatenate([p.cpu().numpy() for p in predictions], axis=0)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"ufhmDxDXC-YL"},"outputs":[],"source":["# predictions.shape"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"K444FB4dDOsm"},"outputs":[],"source":["probs = np.exp(predictions)\n","probs = probs / np.sum(probs, axis=1, keepdims=True)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"AEtYHhZADTP5"},"outputs":[{"data":{"text/plain":["array([0.9507854 , 0.04921464], dtype=float32)"]},"execution_count":29,"metadata":{},"output_type":"execute_result"}],"source":["probs[0, :]"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"rDej1c1xDhyn"},"outputs":[],"source":["labels = [y for _, y in ds_val]"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"-7-Cda8wD05f"},"outputs":[],"source":["preds = np.argmax(probs, axis=1)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"nFt5qJgbEF4U"},"outputs":[{"data":{"text/plain":["array([[37, 37],\n","       [74, 95]])"]},"execution_count":32,"metadata":{},"output_type":"execute_result"}],"source":["cm = confusion_matrix(labels, preds, normalize=\"true\")\n","cm_n = confusion_matrix(labels, preds)\n","\n","cm_n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"Ul7IfyAjUDij"},"outputs":[{"data":{"text/plain":["array([[0.5       , 0.5       ],\n","       [0.43786982, 0.56213018]])"]},"execution_count":33,"metadata":{},"output_type":"execute_result"}],"source":["cm"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"o7hAoZ37EKiI"},"outputs":[],"source":["acc = np.sum(labels == preds) / len(labels)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"PtrsMvK_Q5Ki"},"outputs":[{"data":{"text/html":["\n","  \u003cdiv id=\"df-baa4fb73-4a74-43f6-b75b-972d08fbc5dd\"\u003e\n","    \u003cdiv class=\"colab-df-container\"\u003e\n","      \u003cdiv\u003e\n","\u003cstyle scoped\u003e\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","\u003c/style\u003e\n","\u003ctable border=\"1\" class=\"dataframe\"\u003e\n","  \u003cthead\u003e\n","    \u003ctr style=\"text-align: right;\"\u003e\n","      \u003cth\u003e\u003c/th\u003e\n","      \u003cth\u003epred\u003c/th\u003e\n","      \u003cth\u003elabels\u003c/th\u003e\n","    \u003c/tr\u003e\n","  \u003c/thead\u003e\n","  \u003ctbody\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e0\u003c/th\u003e\n","      \u003ctd\u003e0\u003c/td\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","    \u003c/tr\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e1\u003c/th\u003e\n","      \u003ctd\u003e0\u003c/td\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","    \u003c/tr\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e2\u003c/th\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","    \u003c/tr\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e3\u003c/th\u003e\n","      \u003ctd\u003e0\u003c/td\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","    \u003c/tr\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e4\u003c/th\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","    \u003c/tr\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e...\u003c/th\u003e\n","      \u003ctd\u003e...\u003c/td\u003e\n","      \u003ctd\u003e...\u003c/td\u003e\n","    \u003c/tr\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e238\u003c/th\u003e\n","      \u003ctd\u003e0\u003c/td\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","    \u003c/tr\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e239\u003c/th\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","    \u003c/tr\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e240\u003c/th\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","    \u003c/tr\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e241\u003c/th\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","    \u003c/tr\u003e\n","    \u003ctr\u003e\n","      \u003cth\u003e242\u003c/th\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","      \u003ctd\u003e1\u003c/td\u003e\n","    \u003c/tr\u003e\n","  \u003c/tbody\u003e\n","\u003c/table\u003e\n","\u003cp\u003e243 rows × 2 columns\u003c/p\u003e\n","\u003c/div\u003e\n","      \u003cbutton class=\"colab-df-convert\" onclick=\"convertToInteractive('df-baa4fb73-4a74-43f6-b75b-972d08fbc5dd')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\"\u003e\n","        \n","  \u003csvg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\"\u003e\n","    \u003cpath d=\"M0 0h24v24H0V0z\" fill=\"none\"/\u003e\n","    \u003cpath d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/\u003e\u003cpath d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/\u003e\n","  \u003c/svg\u003e\n","      \u003c/button\u003e\n","      \n","  \u003cstyle\u003e\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  \u003c/style\u003e\n","\n","      \u003cscript\u003e\n","        const buttonEl =\n","          document.querySelector('#df-baa4fb73-4a74-43f6-b75b-972d08fbc5dd button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-baa4fb73-4a74-43f6-b75b-972d08fbc5dd');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '\u003ca target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb\u003edata table notebook\u003c/a\u003e'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      \u003c/script\u003e\n","    \u003c/div\u003e\n","  \u003c/div\u003e\n","  "],"text/plain":["     pred  labels\n","0       0       1\n","1       0       1\n","2       1       1\n","3       0       1\n","4       1       1\n","..    ...     ...\n","238     0       1\n","239     1       1\n","240     1       1\n","241     1       1\n","242     1       1\n","\n","[243 rows x 2 columns]"]},"execution_count":35,"metadata":{},"output_type":"execute_result"}],"source":["import pandas as pd\n","pred_df = pd.DataFrame(\n","    {'pred': preds.tolist(),\n","     'labels' : labels})\n","pred_df"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"Ck1RDgasg-p3"},"outputs":[{"name":"stdout","output_type":"stream","text":["0.5432098765432098\n"]}],"source":["print(acc)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"JTt2HEbchAx6"},"outputs":[],"source":["pred_df.to_csv('{}.csv'.format(model_name))"]}],"metadata":{"accelerator":"GPU","colab":{"background_execution":"on","collapsed_sections":[],"name":"3_training_and_testing_WeightDecay柏翔跑中風非中風","provenance":[{"file_id":"1700nn4xe0KPJY9Bz-tyQhAvtYAU8zEyO","timestamp":1658101952497},{"file_id":"1vHHNbZaXBDydZyesnQfD2jGrOmE7SroH","timestamp":1657727835439}],"version":""},"gpuClass":"standard","kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"1c13924ed2be490db9fffc582d13ea3d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_68695ae41a144e66b248c2f0c8e05761","placeholder":"​","style":"IPY_MODEL_c7acaeb2d98948b98f0992f21edccef7","value":" 0/837 [00:00\u0026lt;?, ?it/s]"}},"6180fbc584e4458280a33c2444e621ab":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"675d669766184c91a2eb4969e1cd842e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"68695ae41a144e66b248c2f0c8e05761":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9796ffaabca74c1da2d1d69f392ebad0":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b925602206c44ef7964ac508c547010a","placeholder":"​","style":"IPY_MODEL_675d669766184c91a2eb4969e1cd842e","value":"  0%"}},"a7dffa3060124c63b685c3799e606317":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_9796ffaabca74c1da2d1d69f392ebad0","IPY_MODEL_fc8b9d6776e64810b1409bfa36579078","IPY_MODEL_1c13924ed2be490db9fffc582d13ea3d"],"layout":"IPY_MODEL_b8dea8728cac495e846037667334c44b"}},"b8dea8728cac495e846037667334c44b":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b925602206c44ef7964ac508c547010a":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c7acaeb2d98948b98f0992f21edccef7":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"dc1960bae6cb44a1aa9389fd298c7d9a":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"fc8b9d6776e64810b1409bfa36579078":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"","description":"","description_tooltip":null,"layout":"IPY_MODEL_6180fbc584e4458280a33c2444e621ab","max":837,"min":0,"orientation":"horizontal","style":"IPY_MODEL_dc1960bae6cb44a1aa9389fd298c7d9a","value":0}}}}},"nbformat":4,"nbformat_minor":0}